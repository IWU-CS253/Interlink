{% extends 'layout.html' %}
{% block body %}
<div class="container mt-4">
    <h1>League Manager for {{ league['league_name'] }}</h1>
    <p class="text-muted">
        Manage schedule and scores for this league.
    </p>
    <div class="d-flex">
        <div class="me-1">
            <a class="btn btn-secondary btn-sm mb-3"
               href="{{ url_for('league_page', league_id=league['id']) }}">
                ‚Üê Back to League Page
            </a>
        </div>
        <div class="me-1">
            <form method="post"
            action="{{ url_for('delete_league', league_id=league['id']) }}"
            onsubmit="return confirm('Are you sure you want to delete this league?');">
                <button type="submit" class="btn btn-sm btn-danger">
                Delete League
                </button>
            </form>
        </div>
        <div>
            <a href="{{ url_for('generate_schedule', league_id=league['id']) }}" class="btn mb-3 btn-sm btn-success">Generate New Schedule</a>
        </div>
    </div>
    <!-- Games played in this league -->
    <h3 class="mt-3">Games</h3>
    {# Checks for played games #}
    {% if games %}
        <ul style="height:400px" class="list-group overflow-auto mb-4">
            {% for game in games %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <span>
                        {{ game['home_team'] }} vs {{ game['away_team'] }}:
                        {{ game['home_score'] }} - {{ game['away_score'] }}
                        ({{ game['game_date'] }})
                    </span>
                    <a href="{{ url_for('edit_score') }}?game_id={{ game['id'] }}" class="btn btn-warning btn-sm">
                        Edit Score
                    </a>
                </li>
            {% endfor %}
        </ul>
    {# If no played games #}
    {% else %}
        <p>No games played yet.</p>
    {% endif %}
    <div class="d-flex">
        <div class="me-1">
            <p><strong>Status:</strong> {{ league['status'] }}</p>
        </div>
        <div class="ms-2">
           <form action="/change_phase" method="POST">
               <input type="hidden" name="league_id" value="{{ league["id"] }}">
                <input type="hidden" name="status" value="{{ league["status"] }}">
                {# If statement to display option to activate league if league in signup phase #}
                <button class="btn btn-primary btn-sm mb-3" type="submit" onclick="return confirm('Are you sure you want activate this league? You cannot re-open signups after activating.');" {% if league['status'] == "active" %}disabled hidden{% endif %}>
                    Activate League
                </button>
            </form>
        </div>
    </div>
    <div style="max-height: 600px;" class="overflow-auto">
    <!-- Teams and rosters -->
    {# Loops through teams and displays them #}
    {% for team in teams %}
        <div class="card mb-3">
            <div class="card-header d-flex justify-content-between align-items-center">
                <strong>{{ team.name }}</strong>
                {# Checks if the user is a site admin to allow team deletion #}
                {% if user['role'] == 'admin' %}
                <form action="{{ url_for('del_team', league_id=league['id']) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this team?');">
                    <input type="hidden" value="{{ team.id }}" name="team_id">
                    <button type="submit" class="btn btn-danger mt-1">Delete Team</button>
                </form>
                {% endif %}
            </div>

            <div class="card-body">
                <h6>Players</h6>
                {# Checks if there is a team roster #}
                {% if team.roster %}
                    <ul class="list-group mb-3">
                        {# Loops through to display players #}
                        {% for player_name in team.roster %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>{{ player_name }}</span>
                            </li>
                        {% endfor %}
                    </ul>
                {# If no roster #}
                {% else %}
                    <p>No players on this team yet</p>
                {% endif %}

            </div>
        </div>
    {% endfor %}
    </div>
</div>
{% endblock %}
