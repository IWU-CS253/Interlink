{% extends "layout.html" %}
{% block body %}
<div class="container mt-4">
    <h1>Admin for {{ league['league_name'] }}</h1>
    <p class="text-muted">
        Manage rosters and view games for this league.
    </p>
    <div class="d-flex">
        <div class="me-1">
            <a class="btn btn-secondary btn-sm mb-3"
               href="{{ url_for('league_page', league_id=league['id']) }}">
                ‚Üê Back to League Page
            </a>
        </div>
        <div>
            <form method="post"
            action="{{ url_for('delete_league', league_id=league['id']) }}"
            onsubmit="return confirm('Are you sure you want to delete this league?');">
                <button type="submit" class="btn btn-sm btn-danger">
                Delete League
                </button>
            </form>
        </div>
    </div>
    <!-- Games played in this league -->
    <h3 class="mt-3">Games</h3>
    {% if games %}
        <ul style="height:400px" class="list-group overflow-auto mb-4">
            {% for game in games %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <span>
                        {{ game['home_team'] }} vs {{ game['away_team'] }}:
                        {{ game['home_score'] }} - {{ game['away_score'] }}
                        ({{ game['game_date'] }})
                    </span>
                    <a href="{{ url_for('edit_score') }}?game_id={{ game['id'] }}" class="btn btn-warning btn-sm">
                        Edit Score
                    </a>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No games played yet.</p>
    {% endif %}
    <div class="d-flex">
        <div class="me-1">
            <p><strong>Status:</strong> {{ league['status'] }}</p>
        </div>
        <div class="ms-2">
           <form action="/change_phase" method="POST">
               <input type="hidden" name="league_id" value="{{ league["id"] }}">
                <input type="hidden" name="status" value="{{ league["status"] }}">
                <button class="btn btn-primary btn-sm mb-3"type="submit"> {% if league['status'] == "active" %}
                    Open League for Sign-Ups
                {% elif league['status'] == "signup" %}
                    Close Sign-Ups
                {% else %}
                    Change Phase
                {% endif %}
                </button>
            </form>
        </div>
    </div>
    <div style="max-height: 600px;" class="overflow-auto">
    <!-- Teams and rosters -->
    {% for team in teams %}
        <div class="card mb-3">
            <div class="card-header d-flex justify-content-between align-items-center">
                <strong>{{ team.name }}</strong>

                {% if league['status'] == 'signup' %}
                    <form method="post"
                          action="{{ url_for('del_team', league_id=league['id']) }}"
                          onsubmit="return confirm('Are you sure you want to delete this team?');">
                        <input type="hidden" name="team_id" value="{{ team.id }}">
                        <button type="submit" class="btn btn-sm btn-danger">
                            Delete team
                        </button>
                    </form>
                {% else %}
                    <span class="badge bg-secondary">Teams locked</span>
                {% endif %}
            </div>
            <div class="card-body">
                <h6>Players</h6>

                {% if team.roster %}
                    <ul class="list-group mb-3">
                        {% for player_name in team.roster %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>{{ player_name }}</span>
                                <form method="post"
                                      action="{{ url_for('remove_player', league_id=league['id']) }}"
                                      class="m-0">
                                    <input type="hidden" name="team_name" value="{{ team.name }}">
                                    <input type="hidden" name="player_name" value="{{ player_name }}">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">
                                        Remove
                                    </button>
                                </form>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>No players on this team yet</p>
                {% endif %}

                <!-- admin form to add players to each team-->
                <h6>Add player by username</h6>
                <form method="post"
                      action="{{ url_for('admin_add_player', league_id = league['id']) }}"
                      class="row g-2">
                    <input type="hidden" name="team" value="{{ team.name }}">
                    <div class="col-sm-8">
                        <input type="text"
                               name="username"
                               class="form-control form-control-sm"
                               placeholder="Enter username (login)">
                    </div>
                    <div class="col-sm-4">
                        <button type="submit" class="btn btn-sm btn-primary w-100">
                            Add to team
                        </button>
                    </div>
                </form>
            </div>
        </div>
    {% endfor %}
    </div>
</div>
{% endblock %}
